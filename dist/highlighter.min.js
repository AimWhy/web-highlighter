/*! libName: highlighter; version: 0.0.1; github: https://github.com/alienzhou/highlighter */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Highlighter=t():e.Highlighter=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";t.__esModule=!0,function(e){e.none="none",e.head="head",e.tail="tail",e.both="both"}(t.SplitType||(t.SplitType={})),function(e){e.LOCAL="localStorage",e.REMOTE="remote",e.INDEX_DB="indexDB",e.MEMORY="memory"}(t.StoreType||(t.StoreType={})),function(e){e.DOM_TYPE_ERROR="[DOM] receive wrong node type",e.DB_ID_DUPLICATE_ERROR="[STORE] unique id conflict"}(t.ERROR||(t.ERROR={})),function(e){e.INIT="highlight-init",e.CREATE="highlight-create",e.REMOVE="highlight-remove",e.MODIFY="highlight-modify",e.HOVER="highlight-hover",e.HOVER_OUT="highlight-hover-out"}(t.EventType||(t.EventType={}))},function(e,t,n){"use strict";t.__esModule=!0;var o=n(6);t.LOCAL_STORE_KEY="highlight-mengshou",t.STYLE_TAG_ID="highlight-mengshou-style",t.DATASET_IDENTIFIER="highlight-id",t.DATASET_SPLIT_TYPE="highlight-split-type",t.CAMEL_DATASET_IDENTIFIER=o.default(t.DATASET_IDENTIFIER),t.CAMEL_DATASET_SPLIT_TYPE=o.default(t.DATASET_SPLIT_TYPE),t.DEFAULT_OPTIONS={$root:window.document,style:{highlightClassName:"highlight-mengshou-wrap"}};var r=t.DEFAULT_OPTIONS.style;t.STYLE_TAG_TEXT="\n    ."+r.highlightClassName+" {\n        background: #ff9;\n        cursor: pointer;\n    }\n    ."+r.highlightClassName+".active {\n        background: #ffb;\n    }\n"},function(e,t,n){"use strict";var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s};t.__esModule=!0;var r=n(7),i=n(8),s=function(){function e(e,t,n,i,s){var a=o(this.getNodeInfoPartial(e),2),u=a[0],l=a[1],c=o(this.getNodeInfoPartial(t),2),f=c[0],h=c[1];this.startMeta={offset:n,domNode:u,textNode:{index:l}},this.endMeta={offset:i,domNode:f,textNode:{index:h}},this.id=s||r.default(),this.$startNode=e,this.$endNode=t,this.startOffset=n,this.endOffset=i}return e.prototype.freeze=function(){return{start:this.startMeta,end:this.endMeta,id:this.id}},e.prototype.getNodeInfoPartial=function(e){var t=e.parentNode;return[i.markNodeMetaInfo(t),i.countNodeIndex(e)]},e.freeze=function(t,n,o,r,i){return t instanceof e?t.freeze():new e(t,n,o,r,i).freeze()},e.boil=function(t){var n=t.start,o=t.end;return new e(i.getElementByMeta(n),i.getElementByMeta(o),n.offset,o.offset,t.id)},e}();t.default=s},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}u((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var a=n(5),u=n(0),l=n(1),c=n(2),f=n(9),h=n(13),p=function(e){function t(t){var n=e.call(this)||this;return n._handleSelection=function(e){var t=n.paint.highlightSelection();t&&(n.store.save(t),n.emit(u.EventType.CREATE,[t]))},n.run=function(){return n.options.$root.addEventListener("mouseup",n._handleSelection)},n.stop=function(){return n.options.$root.removeEventListener("mouseup",n._handleSelection)},n.options=r({},l.DEFAULT_OPTIONS,t),n.paint=new f.default({$root:n.options.$root,highlightClassName:n.options.style.highlightClassName}),n.store=h.default,n}return o(t,e),t.prototype.init=function(){return i(this,void 0,void 0,function(){var e,t=this;return s(this,function(n){switch(n.label){case 0:return[4,this.store.getAll()];case 1:return(e=n.sent()).forEach(function(e){return t.paint.renderHighlight(e)}),this.options.$root.addEventListener("mouseover",function(e){var n=e.target,o=n.dataset?n.dataset[l.CAMEL_DATASET_IDENTIFIER]:void 0;if(!o)return t._hoverId&&t.emit(u.EventType.HOVER_OUT,t._hoverId),void(t._hoverId=null);t._hoverId!==o&&(t._hoverId=o,t.emit(u.EventType.HOVER,t._hoverId))}),this.emit(u.EventType.INIT,e),[2]}})})},t.prototype.render=function(e){var t=this;return(Array.isArray(c.default)?e:[e]).forEach(function(e){return t.paint.renderHighlight(e)}),this.emit(u.EventType.CREATE,e),this},t.prototype.remove=function(e){e&&(this.paint.removeHighlight(e),this.store.remove(e),this.emit(u.EventType.REMOVE,e))},t.prototype.removeAll=function(){this.paint.removeAllHighlight(),this.store.removeAll(),this.emit(u.EventType.REMOVE)},t.event=u.EventType,t}(a);t.default=p,t.event=u.EventType},function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function s(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new function(e,t,n){this.fn=e,this.context=t,this.once=n||!1}(n,o||e,i),a=r?r+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],s]:e._events[a].push(s):(e._events[a]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function u(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},u.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,o,i,s){var a=r?r+e:e;if(!this._events[a])return!1;var u,l,c=this._events[a],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,i),!0;case 6:return c.fn.call(c.context,t,n,o,i,s),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,o);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},u.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||a(this,i);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||o&&!s[u].once||n&&s[u].context!==n)&&l.push(s[u]);l.length?this._events[i]=1===l.length?l[0]:l:a(this,i)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e){return e.split("-").reduce(function(e,t,n){return e+(0===n?t:t[0].toUpperCase()+t.slice(1))},"")}},function(e,t,n){"use strict";t.__esModule=!0,t.default=function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}},function(e,t,n){"use strict";t.__esModule=!0;var o=n(0);t.countNodeIndex=function(e){if(e instanceof HTMLDocument)return 0;for(var t=e.parentNode.childNodes,n=0;n<t.length;n++)if(e===t[n])return n},t.markNodeMetaInfo=function(e){if(1!==e.nodeType)throw o.ERROR.DOM_TYPE_ERROR;for(var t=e.tagName,n=document.getElementsByTagName(t),r=null,i=0;i<n.length;i++)if(e===n[i]){r=i;break}return{tagName:t,index:r}},t.getElementByMeta=function(e){var t=e.domNode,n=t.tagName,o=t.index,r=e.textNode;return document.getElementsByTagName(n)[o].childNodes[r.index]}},function(e,t,n){"use strict";t.__esModule=!0;var o=n(10),r=n(1),i=n(2),s=n(11),a=function(){function e(e){this.options={$root:e.$root,highlightClassName:e.highlightClassName},this.styleId=r.STYLE_TAG_ID;var t=document.getElementById(this.styleId);if(!t){var n=document.createTextNode(r.STYLE_TAG_TEXT);(t=document.createElement("style")).id=this.styleId,t.appendChild(n),document.head.appendChild(t)}this.$style=t}return e.prototype.renderHighlight=function(e){s.render(this.options.$root,e,this.options.highlightClassName)},e.prototype.highlightSelection=function(){var e=o.getHighlightRange();if(null!==e){var t=new i.default(e.$startNode,e.$endNode,e.startOffset,e.endOffset);return s.render(this.options.$root,t),o.removeSelection(),t}},e.prototype.removeAllHighlight=function(){document.querySelectorAll("[data-"+r.DATASET_IDENTIFIER+"]").forEach(function(e){s.resetDom(e);var t=e.parentNode,n=document.createDocumentFragment();e.childNodes.forEach(function(e){return n.appendChild(e.cloneNode(!1))}),t.replaceChild(n,e)})},e.prototype.removeHighlight=function(e){document.querySelectorAll("span[data-"+r.DATASET_IDENTIFIER+"='"+e+"']").forEach(function(e){s.resetDom(e);var t=e.parentNode,n=document.createDocumentFragment();e.childNodes.forEach(function(e){return n.appendChild(e.cloneNode(!1))}),t.replaceChild(n,e)})},e}();t.default=a},function(e,t,n){"use strict";t.__esModule=!0,t.getHighlightRange=function(){var e=window.getSelection();if(e.isCollapsed)return console.log("没有被选中的内容"),null;var t=e.getRangeAt(0);return{$startNode:t.startContainer,$endNode:t.endContainer,startOffset:t.startOffset,endOffset:t.endOffset}},t.removeSelection=function(){window.getSelection().removeAllRanges()}},function(e,t,n){"use strict";t.__esModule=!0;var o=n(0),r=n(1),i=n(12);t.render=function(e,t,n){var o=t.$startNode,s=t.$endNode,a=t.startOffset,u=t.endOffset;i.default(e,o,s,a,u).forEach(function(e){return function(e,t,n){n||(n=r.DEFAULT_OPTIONS.style.highlightClassName);var o=document.createElement("span");o.classList.add(n),o.dataset[r.CAMEL_DATASET_IDENTIFIER]=t.id,o.dataset[r.CAMEL_DATASET_SPLIT_TYPE]=e.splitType,o.appendChild(e.$node.cloneNode(!1)),e.$node.parentElement.replaceChild(o,e.$node)}(e,t,n)})},t.resetDom=function(e){var t=e.dataset[r.CAMEL_DATASET_SPLIT_TYPE],n=e.previousSibling,i=e.nextSibling;switch(t){case o.SplitType.both:3===n.nodeType&&(e.textContent=n.textContent+e.textContent,e.parentNode.removeChild(n)),3===i.nodeType&&(e.textContent=e.textContent+i.textContent,e.parentNode.removeChild(i));break;case o.SplitType.head:3===n.nodeType&&(e.textContent=n.textContent+e.textContent,e.parentNode.removeChild(n));break;case o.SplitType.tail:3===i.nodeType&&(e.textContent=e.textContent+i.textContent,e.parentNode.removeChild(i));break;case o.SplitType.none:}}},function(e,t,n){"use strict";t.__esModule=!0;var o=n(0),r=n(1);t.default=function(e,t,n,i,s){if(void 0===e&&(e=window.document),t===n&&t instanceof Text){t.splitText(i);var a=t.nextSibling;return a.splitText(s-i),[{$node:a,splitType:o.SplitType.both}]}for(var u=[e],l=[],c=!1,f=null;f=u.pop();)if(!f.dataset||!f.dataset[r.CAMEL_DATASET_IDENTIFIER]){for(var h=f.childNodes,p=h.length-1;p>=0;p--)u.push(h[p]);if(!f.dataset||"1"!==f.dataset.highlight)if(f===t){if(3===f.nodeType){f.splitText(i);var d=f.nextSibling;l.push({$node:d,splitType:o.SplitType.head})}c=!0}else{if(f===n){3===f.nodeType&&((d=f).splitText(s),l.push({$node:d,splitType:o.SplitType.tail}));break}c&&3===f.nodeType&&l.push({$node:f,splitType:o.SplitType.none})}}return l}},function(e,t,n){"use strict";t.__esModule=!0;var o=n(14);t.default=new o.default},function(e,t,n){"use strict";t.__esModule=!0;var o=n(2),r=n(15),i=n(0),s=n(1),a=n(0),u=function(){function e(){this.key=s.LOCAL_STORE_KEY,this.type=a.StoreType.LOCAL}return e.prototype.storeToJson=function(){var e,t=localStorage.getItem(this.key);try{e=JSON.parse(t)||[]}catch(t){e=[]}return e},e.prototype.jsonToStore=function(e){localStorage.setItem(this.key,JSON.stringify(e))},e.prototype.save=function(e){var t=this.storeToJson();return t.filter(function(t){return t.id===e.id}).length>0?r.reject(i.ERROR.DB_ID_DUPLICATE_ERROR):(t.push(e.freeze()),this.jsonToStore(t),r.resolve(!0))},e.prototype.forceSave=function(e){var t=this.storeToJson();return t.push(e.freeze()),this.jsonToStore(t),r.resolve(!0)},e.prototype.get=function(e){var t=this.storeToJson().filter(function(t){return t.id===e}).map(function(e){return o.default.boil(e)});return r.resolve(t[0])},e.prototype.remove=function(e){for(var t=this.storeToJson(),n=null,o=0;o<t.length;o++)if(t[o].id===e){n=o;break}return t.splice(n,1),this.jsonToStore(t),r.resolve(!0)},e.prototype.getAll=function(){return r.resolve(this.storeToJson().map(function(e){return o.default.boil(e)}))},e.prototype.removeAll=function(){return this.jsonToStore([]),r.resolve(!0)},e}();t.default=u},function(e,t,n){"use strict";function o(){var e,t;return{promise:new Promise(function(n,o){e=n,t=o}),resolve:e,reject:t}}t.__esModule=!0,t.default=o,t.resolve=function(e){var t=o();return t.resolve(e),t.promise},t.reject=function(e){var t=o();return t.reject(e),t.promise}}]).default});