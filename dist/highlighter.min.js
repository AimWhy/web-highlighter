/*! libName: highlighter; version: 0.0.1; github: https://github.com/alienzhou/highlighter */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Highlighter=t():e.Highlighter=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.none="none",e.head="head",e.tail="tail",e.both="both"}(t.SplitType||(t.SplitType={})),function(e){e.DOM_TYPE_ERROR="[DOM] receive wrong node type",e.DB_ID_DUPLICATE_ERROR="[STORE] unique id conflict",e.CACHE_SET_ERROR="[CACHE] cache.data can't be set manually, please use .save()",e.SOURCE_TYPE_ERROR="[SOURCE] object isn't a highlight source instance",e.HIGHLIGHT_RANGE_FROZEN="[HIGHLIGHT_RANGE] a highlight range must be frozen before render"}(t.ERROR||(t.ERROR={})),function(e){e.INIT="highlight:init",e.CREATE="selection:create",e.REMOVE="selection:remove",e.MODIFY="selection:modify",e.HOVER="selection:hover",e.HOVER_OUT="selection:hover-out"}(t.EventType||(t.EventType={})),function(e){e.text="text",e.span="span"}(t.SelectedNodeType||(t.SelectedNodeType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(8);t.ID_DIVISION=";",t.LOCAL_STORE_KEY="highlight-mengshou",t.STYLE_TAG_ID="highlight-mengshou-style",t.DATASET_IDENTIFIER="highlight-id",t.DATASET_IDENTIFIER_EXTRA="highlight-id-extra",t.DATASET_SPLIT_TYPE="highlight-split-type",t.CAMEL_DATASET_IDENTIFIER=o.default(t.DATASET_IDENTIFIER),t.CAMEL_DATASET_IDENTIFIER_EXTRA=o.default(t.DATASET_IDENTIFIER_EXTRA),t.CAMEL_DATASET_SPLIT_TYPE=o.default(t.DATASET_SPLIT_TYPE),t.DEFAULT_OPTIONS={$root:window.document,useLocalStore:!1,style:{highlightClassName:"highlight-mengshou-wrap"}};var r=t.DEFAULT_OPTIONS.style;t.STYLE_TAG_TEXT="\n    ."+r.highlightClassName+" {\n        background: #ff9;\n        cursor: pointer;\n    }\n    ."+r.highlightClassName+".active {\n        background: #ffb;\n    }\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),r=n(3),i=function(){function e(e,t,n,o){this.startMeta=e,this.endMeta=t,this.text=n,this.id=o}return e.prototype.boil=function(){var e=r.queryDomByMeta(this.startMeta),t=r.queryDomByMeta(this.endMeta);return new o.default(e.$node,t.$node,e.offset,t.offset,this.text,this.id,!0)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),r=n(0);t.getDomMeta=function(e,t){var n=function(e){for(var t=e.parentNode;t.dataset&&t.dataset[o.CAMEL_DATASET_IDENTIFIER];)t=t.parentNode;return t}(e),r=function(e){for(var t=e.tagName,n=document.getElementsByTagName(t),o=0;o<n.length;o++)if(e===n[o])return o;return-1}(n),i=function(e,t){for(var n=[e],o=null,r=0;o=n.pop();){for(var i=o.childNodes,a=i.length-1;a>=0;a--)n.push(i[a]);if(3===o.nodeType&&o!==t)r+=o.textContent.length;else if(3===o.nodeType)break}return r}(n,e);return{parentTagName:n.tagName,parentIndex:r,textOffset:i+t}},t.queryDomByMeta=function(e){var t=e.parentTagName,n=e.parentIndex,o=e.textOffset;return function(e,t){for(var n=[e],o=null,r=0,i=0;o=n.pop();){for(var a=o.childNodes,s=a.length-1;s>=0;s--)n.push(a[s]);if(3===o.nodeType&&(i=t-r,(r+=o.textContent.length)>=t))break}return{$node:o,offset:i}}(document.getElementsByTagName(t)[n],o)},t.getSelectedNodes=function(e,t,n,o,i){if(void 0===e&&(e=window.document),t===n&&t instanceof Text){t.splitText(o);var a=t.nextSibling;return a.splitText(i-o),[{$node:a,type:r.SelectedNodeType.text,splitType:r.SplitType.both}]}for(var s=[e],u=[],c=!1,l=null;l=s.pop();){for(var f=l.childNodes,p=f.length-1;p>=0;p--)s.push(f[p]);if(l===t){if(3===l.nodeType){l.splitText(o);var d=l.nextSibling;u.push({$node:d,type:r.SelectedNodeType.text,splitType:r.SplitType.head})}c=!0}else{if(l===n){if(3===l.nodeType)(d=l).splitText(i),u.push({$node:d,type:r.SelectedNodeType.text,splitType:r.SplitType.tail});break}c&&3===l.nodeType&&u.push({$node:l,type:r.SelectedNodeType.text,splitType:r.SplitType.none})}}return u},t.isHighlightWrapNode=function(e){return e.dataset&&e.dataset[o.CAMEL_DATASET_IDENTIFIER]}},function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function a(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new function(e,t,n){this.fn=e,this.context=t,this.once=n||!1}(n,o||e,i),s=r?r+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],a]:e._events[s].push(a):(e._events[s]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function u(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,a=new Array(i);o<i;o++)a[o]=n[o].fn;return a},u.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,o,i,a){var s=r?r+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,i),!0;case 6:return l.fn.call(l.context,t,n,o,i,a),!0}for(c=1,u=new Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var p,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,o);break;default:if(!u)for(p=1,u=new Array(f-1);p<f;p++)u[p-1]=arguments[p];l[c].fn.apply(l[c].context,u)}}return!0},u.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return s(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||o&&!a.once||n&&a.context!==n||s(this,i);else{for(var u=0,c=[],l=a.length;u<l;u++)(a[u].fn!==t||o&&!a[u].once||n&&a[u].context!==n)&&c.push(a[u]);c.length?this._events[i]=1===c.length?c[0]:c:s(this,i)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),r=n(9),i=n(3),a=n(10),s=function(){function e(e,t,n,o,i,a,s){void 0===s&&(s=!1),this.start={$node:e,offset:n},this.end={$node:t,offset:o},this.text=i,this.id=a||r.default(),this.frozen=s}return e.removeDomRange=function(){a.removeSelection()},e.fromSelection=function(){var t=a.getDomRange();return t?new e(t.startContainer,t.endContainer,t.startOffset,t.endOffset,t.toString()):null},e.prototype.freeze=function(){var e=i.getDomMeta(this.start.$node,this.start.offset),t=i.getDomMeta(this.end.$node,this.end.offset);return this.frozen=!0,new o.default(e,t,this.text,this.id)},e}();t.default=s},function(e,t,n){e.exports=n(7)},function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),a=n(0),s=n(1),u=n(5),c=n(2),l=n(11),f=n(12),p=n(14),d=function(e){function t(t){var n=e.call(this)||this;return n._handleSelection=function(e){var t=u.default.fromSelection();if(t){var o=t.freeze();n.paint.highlightRange(t),n.cache.save(o),n.emit(a.EventType.CREATE,[o]),u.default.removeDomRange()}},n.run=function(){return n.options.$root.addEventListener("mouseup",n._handleSelection)},n.stop=function(){return n.options.$root.removeEventListener("mouseup",n._handleSelection)},n.options=r({},s.DEFAULT_OPTIONS,t),n.paint=new f.default({$root:n.options.$root,highlightClassName:n.options.style.highlightClassName}),n.cache=new l.default(n.options.useLocalStore),n}return o(t,e),t.buildFromJSON=function(e){return function(e){return!!(e.startMeta&&e.endMeta&&e.text&&e.id)}(e)?null:new c.default(e.startMeta,e.endMeta,e.text,e.id)},t.prototype.init=function(e){var t=this;void 0===e&&(e=[]),e.forEach(function(e){e instanceof c.default?t.paint.highlightSource(e):console.error(a.ERROR.SOURCE_TYPE_ERROR)}),this.cache.save(e),this.emit(a.EventType.INIT,e),this.options.$root.addEventListener("mouseover",function(e){var n=e.target,o=n.dataset?n.dataset[s.CAMEL_DATASET_IDENTIFIER]:void 0;if(!o)return t._hoverId&&t.emit(a.EventType.HOVER_OUT,t._hoverId),void(t._hoverId=null);t._hoverId!==o&&(t._hoverId=o,t.emit(a.EventType.HOVER,t._hoverId))})},t.prototype.render=function(e){var t=this;return(Array.isArray(e)?e:[e]).forEach(function(e){return t.paint.highlightSource(e)}),this.emit(a.EventType.CREATE,e),this},t.prototype.remove=function(e){e&&(this.paint.removeHighlight(e),this.cache.remove(e),this.emit(a.EventType.REMOVE,e))},t.prototype.removeAll=function(){this.paint.removeAllHighlight(),this.cache.removeAll(),this.emit(a.EventType.REMOVE)},t.event=a.EventType,t.LocalStore=p.default,t}(i);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.split("-").reduce(function(e,t,n){return e+(0===n?t:t[0].toUpperCase()+t.slice(1))},"")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDomRange=function(){var e=window.getSelection();return e.isCollapsed?(console.log("没有被选中的内容"),null):e.getRangeAt(0)},t.removeSelection=function(){window.getSelection().removeAllRanges()}},function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),a=n(0),s=function(e){function t(t){var n=e.call(this)||this;return n._data=new Map,n.useLocalStore=t,n}return o(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this.getAll()},set:function(e){throw a.ERROR.CACHE_SET_ERROR},enumerable:!0,configurable:!0}),t.prototype.save=function(e){var t=this;Array.isArray(e)?e.forEach(function(e){return t._data.set(e.id,e)}):this._data.set(e.id,e)},t.prototype.get=function(e){return this._data.get(e)},t.prototype.remove=function(e){this._data.delete(e)},t.prototype.getAll=function(){var e,t,n=[];this._data=new Map;try{for(var o=r(this._data),i=o.next();!i.done;i=o.next()){var a=i.value;n.push(a[1])}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},t.prototype.removeAll=function(){this._data=new Map},t}(i);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(13),r=n(0),i=n(1),a=function(){function e(e){this.options={$root:e.$root,highlightClassName:e.highlightClassName},this.styleId=i.STYLE_TAG_ID;var t=document.getElementById(this.styleId);if(!t){var n=document.createTextNode(i.STYLE_TAG_TEXT);(t=document.createElement("style")).id=this.styleId,t.appendChild(n),document.head.appendChild(t)}this.$style=t}return e.prototype.highlightRange=function(e){if(!e.frozen)throw r.ERROR.HIGHLIGHT_RANGE_FROZEN;o.render(this.options.$root,e,this.options.highlightClassName)},e.prototype.highlightSource=function(e){var t=e.boil();this.highlightRange(t)},e.prototype.removeAllHighlight=function(){document.querySelectorAll("[data-"+i.DATASET_IDENTIFIER+"]").forEach(function(e){var t=e.parentNode,n=document.createDocumentFragment();e.childNodes.forEach(function(e){return n.appendChild(e.cloneNode(!1))}),t.replaceChild(n,e)})},e.prototype.removeHighlight=function(e){for(var t=new RegExp("("+e+"\\"+i.ID_DIVISION+"|\\"+i.ID_DIVISION+"?"+e+"$)"),n=document.querySelectorAll("span[data-"+i.DATASET_IDENTIFIER+"]"),o=[],r=[],a=[],s=0;s<n.length;s++){var u=n[s].dataset[i.CAMEL_DATASET_IDENTIFIER],c=n[s].dataset[i.CAMEL_DATASET_IDENTIFIER_EXTRA];u!==e||c?u===e?r.push(n[s]):u!==e&&t.test(c)&&a.push(n[s]):o.push(n[s])}o.forEach(function(e){var t=e.parentNode,n=document.createDocumentFragment();e.childNodes.forEach(function(e){return n.appendChild(e.cloneNode(!1))}),t.replaceChild(n,e)}),r.forEach(function(e){var t=e.dataset,n=t[i.CAMEL_DATASET_IDENTIFIER_EXTRA].split(i.ID_DIVISION);t[i.CAMEL_DATASET_IDENTIFIER]=n.shift(),t[i.CAMEL_DATASET_IDENTIFIER_EXTRA]=n.join(i.ID_DIVISION)}),a.forEach(function(e){var n=e.dataset[i.CAMEL_DATASET_IDENTIFIER_EXTRA];e.dataset[i.CAMEL_DATASET_IDENTIFIER_EXTRA]=n.replace(t,"")})},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(3),i=n(1),a=function(e,t,n){var a=e.$node.parentNode,s=e.$node.previousSibling,u=e.$node.nextSibling;if(r.isHighlightWrapNode(a))if(r.isHighlightWrapNode(a)&&(s||u)){var c,l=document.createDocumentFragment(),f=a.dataset[i.CAMEL_DATASET_IDENTIFIER],p=a.dataset[i.CAMEL_DATASET_IDENTIFIER_EXTRA];(c=document.createElement("span")).classList.add(n),c.dataset[i.CAMEL_DATASET_IDENTIFIER]=t.id,c.dataset[i.CAMEL_DATASET_IDENTIFIER_EXTRA]=p?p+i.ID_DIVISION+f:f,c.appendChild(e.$node.cloneNode(!1));var d,h=!1,_=!1,E=void 0;if(s)(d=a.cloneNode(!1)).textContent=s.textContent,l.appendChild(d),h=!0;if(l.appendChild(c),u)(d=a.cloneNode(!1)).textContent=u.textContent,l.appendChild(d),_=!0;E=h&&_?o.SplitType.both:h?o.SplitType.head:_?o.SplitType.tail:o.SplitType.none,c.dataset[i.CAMEL_DATASET_SPLIT_TYPE]=E,a.parentNode.replaceChild(l,a)}else{var T=a.dataset;T[i.CAMEL_DATASET_IDENTIFIER_EXTRA]=T[i.CAMEL_DATASET_IDENTIFIER_EXTRA]?T[i.CAMEL_DATASET_IDENTIFIER_EXTRA]+i.ID_DIVISION+t.id:t.id}else n=n||i.DEFAULT_OPTIONS.style.highlightClassName,(c=document.createElement("span")).classList.add(n),c.dataset[i.CAMEL_DATASET_IDENTIFIER]=t.id,c.dataset[i.CAMEL_DATASET_SPLIT_TYPE]=e.splitType,c.appendChild(e.$node.cloneNode(!1)),e.$node.parentElement.replaceChild(c,e.$node)};t.render=function(e,t,n){var o=t.start,i=o.$node,s=o.offset,u=t.end,c=u.$node,l=u.offset;r.getSelectedNodes(e,i,c,s,l).forEach(function(e){return a(e,t,n)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),r=n(15),i=n(16),a=n(1),s=function(){function e(){this.type=r.StoreType.LOCAL,this.key=a.LOCAL_STORE_KEY}return e.prototype.storeToJson=function(){var e,t=localStorage.getItem(this.key);try{e=JSON.parse(t)||[]}catch(t){e=[]}return e},e.prototype.jsonToStore=function(e){localStorage.setItem(this.key,JSON.stringify(e))},e.prototype.save=function(e){var t=this.storeToJson(),n={};return t.forEach(function(e,t){return n[e.id]=t}),Array.isArray(e)||(e=[e]),e.forEach(function(e){void 0!==n[e.id]?t[n[e.id]]=e:t.push(e)}),this.jsonToStore(t),i.resolve(!0)},e.prototype.forceSave=function(e){var t=this.storeToJson();return t.push(e),this.jsonToStore(t),i.resolve(!0)},e.prototype.get=function(e){var t=this.storeToJson().filter(function(t){return t.id===e}).map(function(e){return new o.default(e.startMeta,e.endMeta,e.text,e.id)});return i.resolve(t[0])},e.prototype.remove=function(e){for(var t=this.storeToJson(),n=null,o=0;o<t.length;o++)if(t[o].id===e){n=o;break}return t.splice(n,1),this.jsonToStore(t),i.resolve(!0)},e.prototype.getAll=function(){return i.resolve(this.storeToJson().map(function(e){return new o.default(e.startMeta,e.endMeta,e.text,e.id)}))},e.prototype.removeAll=function(){return this.jsonToStore([]),i.resolve(!0)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.LOCAL="localStorage",e.INDEX_DB="indexDB"}(t.StoreType||(t.StoreType={}))},function(e,t,n){"use strict";function o(){var e,t;return{promise:new Promise(function(n,o){e=n,t=o}),resolve:e,reject:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o,t.resolve=function(e){var t=o();return t.resolve(e),t.promise},t.reject=function(e){var t=o();return t.reject(e),t.promise}}]).default});